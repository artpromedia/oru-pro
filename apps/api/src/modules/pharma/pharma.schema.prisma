// Prompt 1 â€“ Pharma manufacturing + release schema extension

// Shared enums capture regulatory lifecycle states.
enum BatchStatus {
  PLANNED
  IN_PROCESS
  QA_HOLD
  RELEASED
  REJECTED
}

enum QualitySeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum StabilityCondition {
  AMBIENT
  REFRIGERATED
  FROZEN
  CRYOGENIC
}

model PharmaProduct {
  id               String        @id @default(cuid())
  ndcCode          String        @unique
  sku              String        @unique
  name             String
  dosageForm       String
  strength         String
  shelfLifeMonths  Int
  storageCondition StabilityCondition @default(AMBIENT)
  fillSite         String
  labelingSite     String
  coldChainSensors ColdChainSensor[]
  batchRecords     BatchRecord[]
  createdAt        DateTime      @default(now())
  updatedAt        DateTime      @updatedAt
}

model BatchRecord {
  id                 String       @id @default(cuid())
  product            PharmaProduct @relation(fields: [productId], references: [id])
  productId          String
  lotNumber          String       @unique
  plannedQuantity    Int
  actualQuantity     Int?
  manufacturingSite  String
  batchStatus        BatchStatus  @default(PLANNED)
  qaOwner            String
  qaReleaseDate      DateTime?
  releaseNotes       String?
  deviationReports   DeviationReport[]
  qualityEvents      QualityEvent[]
  coldChainReadings  ColdChainReading[]
  complianceAudits   ComplianceAudit[]
  createdAt          DateTime     @default(now())
  updatedAt          DateTime     @updatedAt
}

model DeviationReport {
  id               String        @id @default(cuid())
  batch            BatchRecord   @relation(fields: [batchId], references: [id])
  batchId          String
  title            String
  description      String
  severity         QualitySeverity
  correctiveAction String?
  preventiveAction String?
  openedAt         DateTime      @default(now())
  closedAt         DateTime?
}

model QualityEvent {
  id          String        @id @default(cuid())
  batch       BatchRecord   @relation(fields: [batchId], references: [id])
  batchId     String
  eventType   String
  details     String
  owner       String
  severity    QualitySeverity
  occurredAt  DateTime      @default(now())
}

model ColdChainSensor {
  id           String         @id @default(cuid())
  product      PharmaProduct  @relation(fields: [productId], references: [id])
  productId    String
  sensorCode   String
  gatewayId    String
  location     String
  readings     ColdChainReading[]
  createdAt    DateTime       @default(now())
}

model ColdChainReading {
  id            String         @id @default(cuid())
  sensor        ColdChainSensor @relation(fields: [sensorId], references: [id])
  sensorId      String
  batch         BatchRecord?   @relation(fields: [batchId], references: [id])
  batchId       String?
  temperatureC  Float
  humidityPct   Float?
  shockEvent    Boolean        @default(false)
  recordedAt    DateTime       @default(now())
}

model ComplianceAudit {
  id             String       @id @default(cuid())
  batch          BatchRecord  @relation(fields: [batchId], references: [id])
  batchId        String
  auditor        String
  findingCount   Int          @default(0)
  criticalFindings Int        @default(0)
  remediationDue DateTime?
  body           String
  issuedAt       DateTime     @default(now())
}
